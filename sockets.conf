# cmdz config for osquery listening sockets
# Usage: cmdz "osqueryi --list --separator ',' \"SELECT s.pid, s.local_port, p.cmdline, p.cwd FROM process_open_sockets AS s INNER JOIN processes AS p ON s.pid = p.pid WHERE s.state = 'LISTEN' ORDER BY p.cmdline\" | column -t -s ',' | sed '1d'" --config sockets.conf

# Skip the header line from osqueryi
--header-lines
1

# Kill selected process (PID is field 1)
--bind
ctrl-k:execute-silent(kill -9 $(echo {1} | xargs))

# Help panel
--preview
echo "Keybindings:"; echo "  ctrl-k  Kill process"; echo "  ctrl-\\  Toggle query/command mode"; echo "  ctrl-h  Toggle this help"; echo "  esc     Exit"; echo ""; echo "Fields: pid, local_port, cmdline, cwd"; echo ""; echo "Example command edits:"; echo "  Change WHERE s.state = 'LISTEN' to 'ESTABLISHED'"; echo "  Add: AND s.local_port > 1024"
--preview-window
up,40%,hidden,wrap
--bind
ctrl-h:toggle-preview
