#!/usr/bin/env bash
# psi-detail - Show detailed process information
# Usage: psi-detail <pid>

set -euo pipefail

PID="${1:-}"

if [[ -z "$PID" ]]; then
    echo "Usage: psi-detail <pid>"
    exit 1
fi

# Check if process exists
if ! ps -p "$PID" > /dev/null 2>&1; then
    echo "Process $PID not found"
    read -n 1 -s -r -p "Press any key to continue..."
    exit 1
fi

clear

echo ""
echo "═══════════════════════════════════════════════════════════════════"
echo "  PROCESS DETAILS (PID: $PID)"
echo "═══════════════════════════════════════════════════════════════════"
echo ""

# Basic info
ps -p "$PID" -o pid=,user=,%cpu=,%mem=,stat=,start=,time= 2>/dev/null | \
    awk '{printf "  PID:     %s\n  User:    %s\n  CPU:     %s%%\n  Memory:  %s%%\n  State:   %s\n  Started: %s\n  Time:    %s\n", $1,$2,$3,$4,$5,$6,$7}'

echo ""
echo "  Command:"
ps -p "$PID" -o command= 2>/dev/null | fold -w 70 | sed 's/^/    /'

echo ""
echo "───────────────────────────────────────────────────────────────────"
echo "  Open files/ports (first 20):"
if lsof -p "$PID" 2>/dev/null | head -21 | awk 'NR>1 {printf "    %-10s %s\n", $5, $9}' | grep -q .; then
    lsof -p "$PID" 2>/dev/null | head -21 | awk 'NR>1 {printf "    %-10s %s\n", $5, $9}'
else
    echo "    (none or permission denied)"
fi

echo ""
echo "═══════════════════════════════════════════════════════════════════"
echo ""
read -n 1 -s -r -p "Press any key to continue..."

